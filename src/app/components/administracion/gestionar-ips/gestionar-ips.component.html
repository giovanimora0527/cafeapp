<div class="page-title-area">
    <div class="row align-items-center">
        <div class="col-sm-6">
            <div class="breadcrumbs-area clearfix">
                <ul class="breadcrumbs pull-left">
                    <li><span><a [routerLink]="['/home']">Parametrizar</a></span></li>
                    <li><span>{{title}}</span></li>
                </ul>
            </div>
        </div>
    </div>
</div>

<div class="main-content-inner">
    <div class="sales-report-area mt-2 mb-5">
        <div class="row">
            <div class="col col-md-8">
                <div class="row" *ngIf="hasPermissionsCreate || hasPermissionHomologar">
                    <div class="col col-md-12">
                        <div class="mainButtons">
                            <a id="btn_crear_asociacion" *ngIf="hasPermissionsCreate" href="#" class="btn btn-primary" style="margin-right: 15px;" data-backdrop="static" data-keyboard="false" data-toggle="modal" data-target="#modal-asociar-ips">
                                <i class="fa fa-plus"></i> Asociar
                            </a>
                            <a id="btn_crear_asociacion" *ngIf="hasPermissionHomologar && hasPermissionsCreate" href="#" class="btn btn-primary" data-backdrop="static" data-keyboard="false" data-toggle="modal" data-target="#modal-homologar">
                                <i class="fa fa-book"></i> Homologar CUPS
                            </a>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col col-md-4">
                <div class="search-box pull-right">
                    <form autocomplete="off">
                        <input id="input_buscar_usuario" #search maxlength="255" type="text" name="search" placeholder="Buscar IPS" required (keyup)="filterBy(search.value)">
                        <i class="ti-search"></i>
                    </form>
                </div>
            </div>

        </div>
        <div class="row" *ngIf="!hasPermissionsCreate && !hasPermissionHomologar">
            <br>
        </div>
        <div class="row removeHeight">
            <div class="col-md-12">
                <div class="card">
                    <div class="card-body">
                        <div class="single-table">
                            <div class="table-responsive table-wrapper-scroll-y">
                                <table datatable class="table table-hover progress-table text-justify table-striped" [mfData]="resultados" #mf="mfDataTable" [mfRowsOnPage]="20">
                                    <thead class="text-center">
                                        <th>
                                            <mfDefaultSorter by="entidadIdIps.nombre">Entidad</mfDefaultSorter>
                                        </th>
                                        <th>
                                            <mfDefaultSorter by="entidadIdErps.tipoEntidad">Tipo Entidad</mfDefaultSorter>
                                        </th>
                                        <th>
                                            <mfDefaultSorter by="nombreResponsableIps">Usuario</mfDefaultSorter>
                                        </th>
                                        <th>
                                            <mfDefaultSorter by="tipoContrato">Tipo de Contrato</mfDefaultSorter>
                                        </th>
                                        <th class="text-center">
                                            <mfDefaultSorter by="estado">Activo</mfDefaultSorter>
                                        </th>
                                        <th class="text-center" *ngIf="hasPermissionsUpdate || hasPermissionRead">
                                            <b>Opciones</b>
                                        </th>
                                    </thead>
                                    <tbody *ngIf="resultados != null && resultados.length > 0">
                                        <tr *ngFor="let ent of mf.data; let i = index;">
                                            <td>
                                                <label *ngIf="entidadLogueada != null && ent.entidadIdErps.id == entidadLogueada.id"> {{ ent.entidadIdIps.nombre }} </label>
                                                <label *ngIf="entidadLogueada != null && ent.entidadIdIps.id == entidadLogueada.id"> {{ ent.entidadIdErps.nombre }} </label>
                                            </td>
                                            <td>
                                                <label *ngIf="ent.entidadIdIps.tipoEntidad == '1'"> ERPS </label>
                                                <label *ngIf="ent.entidadIdIps.tipoEntidad == '2'"> IPS </label>
                                            </td>
                                            <td>
                                                <label *ngIf="entidadLogueada != null && ent.entidadIdErps.id == entidadLogueada.id"> {{ ent.nombreResponsableIps }} </label>
                                                <label *ngIf="entidadLogueada != null && ent.entidadIdIps.id == entidadLogueada.id">  {{ ent.nombreResponsableErps }} </label>
                                            </td>
                                            <td>
                                                N/A
                                            </td>
                                            <td class="text-center">
                                                <i class="ti-check-box" *ngIf="ent.entidadIdIps.estado == 1"></i>
                                                <i class="ti-na" *ngIf="ent.entidadIdIps.estado != 1"></i>
                                            </td>
                                            <td class="text-center" *ngIf="hasPermissionsUpdate || hasPermissionRead">
                                                <div class="notification-area pull-center">
                                                    <a id="editar_ips_{{i+1}}" *ngIf="entidadLogueada != null && ent.entidadIdErps.id == entidadLogueada.id " href="javascript:void(0)" placement="left" ngbTooltip="Editar" (click)="pasarInfoRelacion(ent)" class="edit settings-btn" [routerLink]="['/home', {outlets: {'content': [ 'operaciones-ent', ent.id ]}}]">
                                                        <i class="ti-settings"></i>
                                                    </a>
                                                    <a id="editar_ips_{{i+1}}" *ngIf="hasPermissionRead && entidadLogueada != null && ent.entidadIdErps.id != entidadLogueada.id" href="javascript:void(0)" placement="left" ngbTooltip="Ver" (click)="pasarInfoRelacion(ent)" class="edit settings-btn" [routerLink]="['/home', {outlets: {'content': [ 'operaciones-ent', ent.id ]}}]">
                                                        <i class="ti-search"></i>
                                                    </a>
                                                </div>
                                            </td>
                                        </tr>
                                    </tbody>
                                    <tbody *ngIf="relacionArray == null || relacionArray.length == 0">
                                        <tr>
                                            <td colspan="6" class="text-center">
                                                <label>No se encuentran entidades registrados en el sistema</label>
                                            </td>
                                        </tr>
                                    </tbody>
                                    <tfoot *ngIf="relacionArray != null && relacionArray.length > 0">
                                        <tr>
                                            <td colspan="6">
                                                <mfBootstrapPaginator></mfBootstrapPaginator>
                                            </td>
                                        </tr>
                                    </tfoot>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </div>
</div>

<div class="modal fade" id="modal-asociar-ips">
    <div class="modal-dialog modal-dialog-centered modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="titleModalIps"> Asociar Entidad</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close" id="close-btn-modal">
                  <span aria-hidden="true">&times;</span>
              </button>
            </div>
            <div class="modal-body">
                <app-asociar-ips [isCalledModal]="true" [ipsSelected]="null"></app-asociar-ips>
            </div>

            <div class="modal-footer text-center">
                <button id="btn_guardar_cups" type="button" class="btn btn-outline-primary mb-3" (click)="guardarIPS()">
                    <i class="fa fa-save"></i>
                    <span> Guardar</span>
                </button>
                <button id="btn_cancelar_guardar" type="button" class="btn btn-outline-secondary mb-3" (click)="cancelButtonAction()">
                    <i class="fa fa-times text-danger"></i>
                    <span> Cancelar</span>
                </button>
            </div>
        </div>
    </div>
</div>


<!-- ModalHomologar -->
<div class="modal fade" id="modal-homologar">
    <div class="modal-dialog modal-dialog-centered modal-xl">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="titleModalIps">Homologar CUPS</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close" id="close-btn-modal">
                      <span aria-hidden="true">&times;</span>
                  </button>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col col-md-12">
                        <app-homologar-cups></app-homologar-cups>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>